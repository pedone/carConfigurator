"use strict";class ConfigurationOverviewViewModel{constructor(e){let t=this;this.configurationDescription=ko.observable(""),this.options=e,this.placeOrder=function(){$.ajax({type:"POST",url:"/ConfigurationOverview/PlaceOrder",data:{__RequestVerificationToken:t.options.antiForgeryToken,description:t.configurationDescription()},contentType:"application/x-www-form-urlencoded",dataType:"text"}).done(function(e){console.debug("order successfully placed"),t.options.placeOrderSuccess&&t.options.placeOrderSuccess(e)}).fail(function(e){console.error("failed to place order: "+e.responseText+" ("+e.statusText+")"),console.debug(JSON.stringify(e)),t.options.placeOrderFailure&&t.options.placeOrderFailure()})}}}class ViewModel{constructor(e){this.id=e.Id,this.price=e.Price,this.isSelected=ko.observable(e.IsSelected),this.name=e.Name,this.size=e.Size,this.category=e.Category}}class ConfigurationViewModel{constructor(e){Object.defineProperties(this,{_engineSettingsById:{value:this._toViewModelDictionary(e.EngineSettings),writable:!1,enumerable:!1},_rimsById:{value:this._toViewModelDictionary(e.Rims),writable:!1,enumerable:!1},_paintById:{value:this._toViewModelDictionary(e.Paints),writable:!1,enumerable:!1},accessoriesById:{value:this._toViewModelDictionary(e.Accessories),writable:!1,enumerable:!0}}),this.selectedPaintId=ko.observable(this._getInitialSelectedId(e.Paints)),this._initialPaintId=this.selectedPaintId(),this.selectedRimsId=ko.observable(this._getInitialSelectedId(e.Rims)),this._initialRimsId=this.selectedRimsId(),this.selectedAccessories=ko.observableArray(_.values(this.accessoriesById)).extend({filterSelected:null}),this._initialAccessoryIds=this.selectedAccessoryIds,this.selectedEngineSettings=ko.computed(()=>{let e=_.values(this._engineSettingsById);return _.first(_.filter(e,e=>e.isSelected()))}),this._initialEngineSettings=this.selectedEngineSettings(),this.selectedPaint=ko.computed(()=>this._paintById[this.selectedPaintId()]),this.selectedRims=ko.computed(()=>this._rimsById[this.selectedRimsId()]),this.extrasPrice=ko.computed(()=>{return _.reduce(this.selectedAccessories(),(e,t)=>e+t.price,0)+(this.selectedPaint()&&this.selectedPaint().price)+(this.selectedRims()&&this.selectedRims().price)}),this.basePrice=ko.computed(()=>this.selectedEngineSettings()&&this.selectedEngineSettings().price||0),this.fullPrice=ko.computed(()=>this.basePrice()+this.extrasPrice())}_getInitialSelectedId(e){if(!e||0===e.length)return-1;return(_.find(e,e=>e.IsSelected)||e[0]).Id.toString()}_toViewModelDictionary(e){var t={};return _.each(e,e=>{t[e.Id]=new ViewModel(e)}),t}get selectedAccessoryIds(){return _.map(this.selectedAccessories(),e=>e.id)}countCategory(e,t){return _.filter(e,e=>e.category===t).length}selectEngineSettings(e){_.each(this._engineSettingsById,t=>{t.isSelected(t.id===e)})}selectPaint(e){this.selectedPaintId(e)}selectAccessory(e){let t=this.accessoriesById[e].isSelected();this.accessoriesById[e].isSelected(!t)}saveChanges(e){let t=this.selectedAccessoryIds,i=this._initialAccessoryIds.length!==t.length||_.difference(this._initialAccessoryIds,this.selectedAccessoryIds).length>0,s=this._initialEngineSettings!=this.selectedEngineSettings(),o=this._initialPaintId!=this.selectedPaintId(),n=this._initialRimsId!=this.selectedRimsId();if(!(i||s||o||n))return void console.debug("no configuration changes");let r={__RequestVerificationToken:e};o&&(r.paintId=viewModel.selectedPaintId()),n&&(r.rimId=viewModel.selectedRimsId()),s&&(r.engineSettingsId=viewModel.selectedEngineSettings().id),i&&(r.accessoryIds=t),console.debug("saving configuration changes"),$.ajax({async:!1,type:"POST",url:"/Configuration/UpdateActiveConfiguration",data:r,contentType:"application/x-www-form-urlencoded"}).fail(e=>{console.error("failed to save configuration changes: "+e.responseText+" ("+e.statusText+")"),console.debug(JSON.stringify(e))})}}function saveViewModel(e,t,i,s){let o,n={__RequestVerificationToken:i};if(t&&(n.id=t),s)for(o in s)s.hasOwnProperty(o)&&(n[o]=s[o]);return $.ajax({type:"POST",url:e,data:n,contentType:"application/x-www-form-urlencoded"})}function getAntiForgeryToken(e){return e.find('[name="__RequestVerificationToken"]').val()}function formatCurrency(e){return e.toLocaleString()+" EUR"}ko.extenders.filterSelected=function(e){let t,i=e(),s=ko.observableArray(_.filter(i,e=>e.isSelected()));var o=function(e){return function(t){t?s.push(i[e]):s.remove(i[e])}};for(t=0;t<i.length;t+=1)i[t].isSelected.subscribe(o(t));return s};class ModelSelectionViewModel{constructor(){this.curModelFilter=ko.observable("")}filterModels(e){e!==this.curModelFilter()&&this.curModelFilter(e)}}class OrderItemViewModel{constructor(e){this.id=e.Id,this.basePrice=e.BasePrice,this.extrasPrice=e.ExtrasPrice,this.price=e.Price,this.description=e.Description,this.dateTime=e.DateTime,this.model=e.Model,this.guid=e.Guid,this.linkUrl=e.LinkUrl}}class OrderListViewModel{constructor(e,t){let i=this;this.orders=ko.observableArray(_.map(e,e=>new OrderItemViewModel(e))),this.pages=ko.observableArray([]),_.times(t,e=>this.pages().push(e+1)),this.currentPageIndex=ko.observable(0),this.deleteItem=function(e,t){var s=_.find(i.orders(),t=>t.id==e);if(!s)return void console.error("order "+e+" not found");let o=getAntiForgeryToken(t);(function(e,t){return $.ajax({type:"POST",url:"/OrderList/delete",data:{__RequestVerificationToken:t,id:e,pageIndex:i.currentPageIndex()},contentType:"application/x-www-form-urlencoded",dataType:"json"})})(e,o).done(function(t){if(console.debug("removing order "+e+" from view"),i.orders.remove(s),t.NewItem&&i.orders.push(new OrderItemViewModel(t.NewItem)),i.pages().length!==t.NewPageCount){console.debug("page count changed from "+i.pages().length+" to "+t.NewPageCount),i.pages.pop();let e=i.currentPageIndex()+1;e>i.pages().length&&i.loadPage(e-1)}}).fail(function(e){console.error("failed to delete order: "+e.responseText+" ("+e.statusText+")"),console.debug(JSON.stringify(e)),alert("order "+s.name+" could not be removed")})},this.loadPage=function(e){let t=e-1;t!==i.currentPageIndex()&&$.ajax({async:!1,type:"GET",url:"/OrderList/LoadPage",data:{pageIndex:t},dataType:"json"}).done(function(e){console.debug("order list for page index "+t+" successfully retrieved"),i.currentPageIndex(t),i.orders(_.map(e,e=>new OrderItemViewModel(e)))}).fail(function(e){console.error("failed to load page: "+e.responseText+" ("+e.statusText+")"),console.debug(JSON.stringify(e))})}}}export const dog={talk:function(){console.log("bark")}};export const cat={talk:function(){console.log("meow")}};export const cow={talk:function(){console.log("muuh"),animalTest2()}};function animalTest2(){console.log("animalTest")}function animalTest(){console.log("animalTest")}console.log("animals loaded");import{dog,cat}from"./animals.js";function test(){cat.talk(),dog.talk()}export function test2(){console.log("main test2")}console.log("loaded");