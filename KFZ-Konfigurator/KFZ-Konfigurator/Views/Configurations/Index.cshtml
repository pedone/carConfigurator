@using KFZ_Konfigurator.Helper;
@model IEnumerable<KFZ_Konfigurator.ViewModels.ConfigurationViewModel>

@{
    ViewBag.Title = "Configurations";
}

@Html.AntiForgeryToken()
<h2 class="mt-3">Configurations</h2>

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Price)
        </th>
        <th></th>
    </tr>

    <tbody data-bind="foreach: configurations">
        <tr>
            <td data-bind="text: name"></td>
            <td data-bind="text: formatCurrency(price)"></td>
            <td>
                <a data-bind="attr: {href: linkUrl}">@LocalizationManager.Localize("Load")</a>
                <a href="#" data-bind="click: function(data, event) { $parent.deleteItem(data, event, $(document)) }, visible: !hasOrders">
                    @LocalizationManager.Localize("Delete")
                </a>
            </td>
        </tr>
    </tbody>
</table>

@section scripts {
    <script type="text/javascript" src="@Url.Content("/Scripts/app/ConfigurationListViewModel.js")"></script>
    <script type="text/javascript" src="@Url.Content("/Scripts/app/AjaxHelper.js")"></script>
    <script type="text/javascript">
        let configurations = @Html.Raw(Json.Encode(Model));
        let loadConfigurationRouteTemplate = "@Url.RouteUrl(Constants.Routes.LoadConfiguration, new { guid = "Placeholder" })";
        let viewModel = new ConfigurationListViewModel(configurations, loadConfigurationRouteTemplate);

        function formatCurrency(amount) {
            return amount.toFixed(2) + ' EUR';
        }
        $(document).ready(function () {
            ko.applyBindings(viewModel);
        });
    </script>
}