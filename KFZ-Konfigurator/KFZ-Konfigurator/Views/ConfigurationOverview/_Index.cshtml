@model KFZ_Konfigurator.ViewModels.ConfigurationOverviewPageViewModel

@{
    ViewBag.Title = LocalizationManager.Localize("ConfigurationOverviewView_Title");
    bool renderScripts = (bool)(ViewData[Constants.PartialView.RenderScripts] ?? false);
}

@if (!renderScripts)
{
    @Html.AntiForgeryToken()
    <h2>@LocalizationManager.Localize("ConfigurationOverviewView_Header")</h2>

    <div id="content">
        @Html.Partial("_ConfigurationOverview")
    </div>

    @* Order *@
    <p>
        <button class="btn btn-dark" type="button" data-toggle="collapse" data-target="#orderCollapse">@LocalizationManager.Localize("ConfigurationOverviewView_Order_Button")</button>
    </p>
    <div class="collapse" id="orderCollapse">
        <div class="card card-body">
            <div class="input-group">
                <input type="text" class="form-control"
                       placeholder="@LocalizationManager.Localize("ConfigurationOverviewView_OrderDescription_Placeholder")"
                       data-bind="value: configOVVM.configurationDescription" />
                <div class="input-group-append">
                    <button class="btn btn-primary" id="placeOrderButton" type="button" data-bind="click: configOVVM.placeOrder">
                        @LocalizationManager.Localize("ConfigurationOverviewView_PlaceOrder_Button")
                    </button>
                </div>
            </div>
            <div class="mt-3">
                <div class="alert alert-danger fade show" id="orderFailedAlert" role="alert" hidden>
                    Your order could not be placed
                </div>
            </div>
        </div>
    </div>
}

@if (renderScripts)
{
    <script id="@Constants.PartialView.ScriptContentId" type="text/javascript">
        $(document).ready(function () {
            let options = {
                antiForgeryToken: getAntiForgeryToken($(document)),
                placeOrderSuccess: function (targetUrl) {
                    window.location.href = targetUrl;
                },
                placeOrderFailure: function () {
                    $('#orderFailedAlert').attr('hidden', false);
                }
            };
            configurationView.applyViewModelToPartialContent({ configOVVM: new ConfigurationOverviewViewModel(options) });
        });
    </script>
}
